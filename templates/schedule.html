<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FitAura – Schedule</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-green-100 to-lime-50 h-screen flex flex-col">
  <!-- Top Navbar -->
  <nav class="bg-white shadow-md py-4 px-6 flex justify-between items-center">
    <div class="flex items-center space-x-4">
       <div class="w-14 h-14 rounded-full border-4 border-emerald-300 overflow-hidden">
         <img src="/static/assets/logo.png" alt="FitAura Logo" class="w-full h-full object-cover">
       </div>
       <h1 class="text-2xl font-bold text-emerald-700">FitAura</h1>
    </div>
    <div class="space-x-4">
      <div class="space-x-5 text-green-800 font-medium">
      <a href="/index" class="hover:text-green-600">Home</a>
      <a href="/profile" class="hover:text-green-600">Profile</a>
      <a href="/about" class="hover:text-green-600">About</a>
      <a href="/logout" class="hover:text-red-500">Logout</a>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="pt-10 px-4 max-w-xl mx-auto w-full flex-grow overflow-y-auto mb-24">
    <h2 class="text-2xl font-bold text-emerald-700 mb-6 text-center">🗓️ Daily Scheduler</h2>

    <form method="POST" class="bg-white p-6 rounded-xl shadow-md border border-emerald-200 space-y-4">
      <div>
        <label for="task" class="block mb-1 font-medium text-emerald-700">Task</label>
        <input type="text" id="task" name="task" class="w-full px-4 py-2 rounded border border-emerald-300" required />
      </div>

      <div>
        <label for="date" class="block mb-1 font-medium text-emerald-700">Date</label>
        <input type="date" id="date" name="date" class="w-full px-4 py-2 rounded border border-emerald-300" required />
      </div>

      <div>
        <label for="time" class="block mb-1 font-medium text-emerald-700">Time</label>
        <input type="time" id="time" name="time" class="w-full px-4 py-2 rounded border border-emerald-300" required />
      </div>

      <button type="submit" class="w-full bg-emerald-600 text-white py-2 rounded hover:bg-emerald-700">Add Task</button>
    </form>

    <!-- Upcoming Tasks -->
    <section class="mt-10">
      <h3 class="text-lg font-semibold text-emerald-700 mb-3">📋 Your Scheduled Tasks</h3>
      <ul id="task-list" class="space-y-3">
        {% for task in tasks %}
          <li class="bg-white p-4 rounded border border-emerald-200 flex justify-between items-center">
            <div>
              <strong>{{ task.task }}</strong><br />
              {{ task.date }} at {{ task.time }}
            </div>
            <form method="POST" action="/delete-task" onsubmit="return confirm('Are you sure?')">
              <input type="hidden" name="task_id" value="{{ task.id }}">
              <button type="submit" class="text-red-600 hover:underline">Remove</button>
            </form>
          </li>
        {% endfor %}
      </ul>
    </section>
  </main>

  <!-- Bottom Navbar -->
  <nav class="fixed bottom-0 left-0 right-0 bg-white border-t shadow-inner z-50">
    <div class="flex justify-around items-center py-3 text-sm text-gray-700">
      <a href="/index" class="flex flex-col items-center hover:text-green-700">
        <span>🏠</span><span>Home</span>
      </a>
      <a href="/bmi" class="flex flex-col items-center hover:text-green-700">
        <span>📏</span><span>BMI</span>
      </a>
      <a href="/diet" class="flex flex-col items-center hover:text-green-700">
        <span>🥗</span><span>Diet</span>
      </a>
      <a href="/schedule" class="flex flex-col items-center hover:text-green-700 font-bold underline">
        <span>📅</span><span>Plan</span>
      </a>
      <a href="/chatbot" class="flex flex-col items-center text-green-700 font-semibold">
        <span>🤖</span><span>Bot</span>
      </a>
    </div>
  </nav>

  <!-- Notification Data -->
  <script type="application/json" id="task-data">
    [
      {% for task in tasks %}
        {
          "task": "{{ task.task }}",
          "date": "{{ task.date }}",
          "time": "{{ task.time }}"
        }{% if not loop.last %},{% endif %}
      {% endfor %}
    ]
  </script>

  <!-- Notification Script -->
  <script>
    const tasks = JSON.parse(document.getElementById("task-data").textContent);
    const notifiedTasks = {};

    function checkTaskNotifications() {
      const now = new Date();
      const currentDate = now.toISOString().split("T")[0];
      const currentTime = now.toTimeString().slice(0, 5); // "HH:MM"

      tasks.forEach(task => {
        const key = task.task + task.date + task.time;
        if (task.date === currentDate && task.time === currentTime && !notifiedTasks[key]) {
          new Notification("⏰ Task Reminder", {
            body: `${task.task} at ${task.time}`,
            icon: "https://img.icons8.com/emoji/48/alarm-clock-emoji.png"
          });
          notifiedTasks[key] = true;
        }
      });
    }

    if (Notification.permission !== "granted") {
      Notification.requestPermission();
    }

    setInterval(checkTaskNotifications, 60000); // every minute
  </script>

</body>
</html>
